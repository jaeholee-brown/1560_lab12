# 1560_lab12
Week 12 Lab

This repository implements a R pipeline for estimating bike-share demand using Non-Homogeneous Poisson Processes (NHPPs), simulating expected usage, and optimizing bike placement across stations for various fleet sizes. The project is organized into multiple R scripts, each responsible for one stage of the workflow.

1. utils.R

Contains helper function and data-loading utilities

Key function: load_and_clean_data(filepath)
Reads in the raw bike-share dataset, converts time columns to POSIXct, standardizes station names, removes invalid rows, and returns a clean tibble.

2. estimation.R

Implements NHPP rate estimation from historical trip data.

Key function:estimate_nhpp_rates(df)
- Computes hourly average trips for each originâ€“destination pair.
- Produces estimated intensities mu_hat = avg_trips / avg_avail for each hour & route.
- Returns a tibble of NHPP rate estimates used in simulation.

3. simulation.R

Simulates bike-share system behavior using the estimated NHPP model.

Key function: generate_demand_thinning(rates)
- Uses thinning to simulate a full day of demand for every station pair based on mu_hat(t).
- Returns a tibble of simulated trips, each with a start station, end station, and when the trip happened.

Key function: run_day_simulation(demand, starting_counts)
- Processes simulated trips in chronological order, updating bike inventory.
- Trip duration is assumed to be 0 (instant transfer).
- Returns the number of missed trips for that day.

4. placement.R

Generates candidate bike placements and selects the best allocation.

Key function: generate_candidates(stations, total_bikes, rates, n_candidates)
Uses a multinomial distribution weighted by historical demand to propose several bike allocations.

Key function: optimize_fleet(rates, stations, total_bikes, n_sims)
- For each candidate allocation, simulates multiple days of demand and computes average missed trips.
- Returns the candidate allocation with the lowest expected unmet demand.

Key function: run_scenarios(df, fleet_sizes)
- Full workflow: estimate rates, optimize allocation, summarize results for multiple fleet sizes.
- Returns a list containing best allocation and expected missed trips for each fleet size.

5. runner.R

Entry point for running the full pipeline.

- Loads all scripts
- Loads and cleans the dataset
- Runs run_scenarios() for a set of fleet sizes
- Prints recommended allocations and expected missed trips

6. plotting.R

Generates visualizations and saves outputs to the "results"" folder.

Plots/tables generated
- Barplots of recommended allocations for each fleet size
- CSV tables of allocations

7. tester.R
Different unit tests using testthat.

8. "results" folder
Contains output files generated by plots.R:
